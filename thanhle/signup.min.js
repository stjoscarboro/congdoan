var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,a,d){b instanceof String&&(b=String(b));for(var c=b.length,e=0;e<c;e++){var g=b[e];if(a.call(d,g,e,b))return{i:e,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,d){b!=Array.prototype&&b!=Object.prototype&&(b[a]=d.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,a,d,c){if(a){d=$jscomp.global;b=b.split(".");for(c=0;c<b.length-1;c++){var e=b[c];e in d||(d[e]={});d=d[e]}b=b[b.length-1];c=d[b];a=a(c);a!=c&&null!=a&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.owns=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(b,a){for(var d=1;d<arguments.length;d++){var c=arguments[d];if(c)for(var e in c)$jscomp.owns(c,e)&&(b[e]=c[e])}return b};$jscomp.polyfill("Object.assign",function(b){return b||$jscomp.assign},"es6","es3");var $jscomp$destructuring$var0=require("../resources/js/angular-app.js"),app=$jscomp$destructuring$var0.app;require("../resources/js/parish-service.js");require("./signup.scss");
(function(){var b=function(a,b,c,e,g){a.init=function(){a.total=90;a.formData={};a.listIndex=0;a.signups=[];a.nav={};d()};a.submit=function(){var h=[],k=a.formData;a.signupData=[];e.loadSignups().then(function(f){a.signups=f;a.signups.forEach(function(b){var f=a.formData[b.date],c=b.data.find(function(a){return f.name&&a.name===f.name}),d=0;b.data.forEach(function(a){a.order>d&&(d=a.order)});c?(c.name=k.name,c.email=k.email,c.phone=k.phone,c.count=f.count,!c.order&&(c.order=d+1)):(c=g.pick(k,"name",
"email","phone"),c.count=f.count,c.order=d+1,b.data.push(c));h.push(e.updateSignup(b).then(function(){0<c.count&&(Object.assign(c,g.pick(b,"date","liturgy")),a.signupData.push(c))}))});b.all(h).then(function(){a.signupData.sort(function(a,b){b=b.date;return a.date.getTime()<b.getTime()?-1:1});location.hash="/summary"})})};a.delete=function(b,c){confirm("Are you sure to delete name: "+c.name+" and email: "+c.email+"?")&&e.loadSignups().then(function(h){a.signups=h;var f=a.signups.find(function(a){return a.date.getTime()===
b.getTime()});f.data.forEach(function(a,b){a.name===c.name&&a.email===c.email&&f.data.splice(b,1)});e.updateSignup(f)})};a.formatDate=function(a,b){var c=a.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});a=$.datepicker.formatDate("dd/mm/yy",a);return a+" @"+c+" - "+b};a.formatPhone=function(a){return(a||"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3")};a.getRemaining=function(b){var c=a.signups.find(function(a){return a.date.getTime()===b.getTime()}),f=a.total;c.data.forEach(function(a){f-=
a.count||0});return f};a.checkSignup=function(){var b=a.formData;b&&(a.signups.forEach(function(c){a.formData[c.date]={};c.data.forEach(function(a){var c=b.name&&g.neutralize(a.name,!0).match(new RegExp(g.neutralize(b.name,!0)+"$","i")),f=b.email&&a.email===b.email,d=b.phone&&a.phone===b.phone;if(c||f||d)g.neutralize(a.name,!0)!==g.neutralize(b.name,!0)&&(b.name=a.name),void 0===b.name&&(b.name=a.name),void 0===b.email&&(b.email=a.email),void 0===b.phone&&(b.phone=a.phone)})}),a.signups.forEach(function(c){a.formData[c.date].name=
b.name;a.formData[c.date].email=b.email;a.formData[c.date].phone=b.phone;c.data.forEach(function(b){var d=a.formData[c.date].name,f=a.formData[c.date].email,e=a.formData[c.date].phone;(b.name&&b.name===d||b.email&&b.email===f||b.phone&&b.phone===e)&&Object.assign(a.formData[c.date],g.pick(b,"name","email","phone","count"))})}),$(".content .name").trigger("oninput"),$(".content .email").trigger("oninput"),$(".content .count").trigger("oninput"))};a.checkLimit=function(){a.disableSave="";a.signups.forEach(function(b){var c=
b.date,d=a.formData[c];b=(b=b.data.find(function(a){return d.name&&a.name===d.name}))&&b.count||0;c=a.getRemaining(c);d&&(d.error=null,d.count>c+b&&(d.error="Kh\u00f4ng c\u00f2n \u0111\u1ee7 ch\u1ed7 cho "+d.count+" ng\u01b0\u1eddi",a.disableSave="disabled"))})};a.prevList=function(){$("html").scrollTop(0,0);0<a.listIndex&&--a.listIndex;l()};a.nextList=function(){a.listIndex<a.signups.length-1&&(a.listIndex+=1);$("html").scrollTop(0,0);l()};var d=function(){a.signups&&0!==a.signups.length||m();c.addEventListener("hashchange",
function(b){a.signups?(/\/signup$/.test(b.newURL)&&a.$apply(function(){a.formData={}}),/\/summary$/.test(b.newURL)&&!a.signupData&&(location.hash="/signup")):m()})},m=function(){e.loadSignups().then(function(b){a.signups=b;l();/\/(signup|list)$/.test(location.hash)||(location.hash="/signup")})},l=function(){a.nav.prev=0===a.listIndex?"disabled":"";a.nav.next=a.listIndex===a.signups.length-1?"disabled":""}};b.$inject=["$scope","$q","$window","ParishService","AppUtil"];app.controller("thanhle",b)})();
(function(){var b=function(a,b){var c=location.pathname.split("/")[1];a.when("/summary",{templateUrl:"/"+c+"/thanhle/summary.html"}).when("/list",{templateUrl:"/"+c+"/thanhle/list.html"}).when("/fulllist",{templateUrl:"/"+c+"/thanhle/fulllist.html"}).otherwise({templateUrl:"/"+c+"/thanhle/signup.html"});b.hashPrefix("")};b.$inject=["$routeProvider","$locationProvider"];app.config(b)})();
