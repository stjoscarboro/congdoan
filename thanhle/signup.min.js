var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,a,f){b instanceof String&&(b=String(b));for(var e=b.length,g=0;g<e;g++){var m=b[g];if(a.call(f,m,g,b))return{i:g,v:m}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,f){b!=Array.prototype&&b!=Object.prototype&&(b[a]=f.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,a,f,e){if(a){f=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var g=b[e];g in f||(f[g]={});f=f[g]}b=b[b.length-1];e=f[b];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(f,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.owns=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};
$jscomp.assign="function"==typeof Object.assign?Object.assign:function(b,a){for(var f=1;f<arguments.length;f++){var e=arguments[f];if(e)for(var g in e)$jscomp.owns(e,g)&&(b[g]=e[g])}return b};$jscomp.polyfill("Object.assign",function(b){return b||$jscomp.assign},"es6","es3");var $jscomp$destructuring$var0=require("../resources/js/angular-app.js"),app=$jscomp$destructuring$var0.app;require("../resources/js/parish-service.js");require("./signup.scss");
(function(){var b=function(a,b,e,g,m){a.init=function(){a.total=90;a.formData={};a.listIndex=0;a.signups=[];a.nav={};f()};a.submit=function(){var c=[],l=a.formData;a.signupData=[];n().then(function(){for(var d={},q=0;q<a.signups.length;d={$jscomp$loop$prop$data$8:d.$jscomp$loop$prop$data$8,$jscomp$loop$prop$item$9:d.$jscomp$loop$prop$item$9,$jscomp$loop$prop$signup$10:d.$jscomp$loop$prop$signup$10},q++){d.$jscomp$loop$prop$signup$10=a.signups[q];d.$jscomp$loop$prop$data$8=a.formData[d.$jscomp$loop$prop$signup$10.date];
d.$jscomp$loop$prop$item$9=void 0;var h=0;if(d.$jscomp$loop$prop$signup$10.allow){d.$jscomp$loop$prop$item$9=d.$jscomp$loop$prop$signup$10.data.find(function(a){return function(c){return a.$jscomp$loop$prop$data$8.name&&c.name===a.$jscomp$loop$prop$data$8.name||a.$jscomp$loop$prop$data$8.email&&c.email===a.$jscomp$loop$prop$data$8.email||a.$jscomp$loop$prop$data$8.phone&&c.phone===a.$jscomp$loop$prop$data$8.phone}}(d));for(var k=0;k<d.$jscomp$loop$prop$signup$10.data.length;k++){var e=d.$jscomp$loop$prop$signup$10.data[k];
e.order>h&&(h=e.order)}d.$jscomp$loop$prop$item$9?(d.$jscomp$loop$prop$item$9.name=l.name,d.$jscomp$loop$prop$item$9.email=l.email,d.$jscomp$loop$prop$item$9.phone=l.phone,d.$jscomp$loop$prop$item$9.count=d.$jscomp$loop$prop$data$8.count,!d.$jscomp$loop$prop$item$9.order&&(d.$jscomp$loop$prop$item$9.order=h+1)):(d.$jscomp$loop$prop$item$9=m.pick(l,"name","email","phone"),d.$jscomp$loop$prop$item$9.count=d.$jscomp$loop$prop$data$8.count,d.$jscomp$loop$prop$item$9.order=h+1,d.$jscomp$loop$prop$signup$10.data.push(d.$jscomp$loop$prop$item$9));
c.push(g.updateSignup(d.$jscomp$loop$prop$signup$10).then(function(c){return function(){0<c.$jscomp$loop$prop$item$9.count&&(Object.assign(c.$jscomp$loop$prop$item$9,m.pick(c.$jscomp$loop$prop$signup$10,"date","liturgy")),a.signupData.push(c.$jscomp$loop$prop$item$9))}}(d)))}}b.all(c).then(function(){a.signupData.sort(function(a,c){c=c.date;return a.date.getTime()<c.getTime()?-1:1});location.hash="/summary"})})};a.delete=function(c,b){confirm("Are you sure to delete name: "+b.name+" and email: "+
b.email+"?")&&n().then(function(){for(var d=a.signups.find(function(a){return a.date.getTime()===c.getTime()}),l=0;l<d.data.length;l++){var h=d.data[l];h.name===b.name&&h.email===b.email&&h.phone===b.phone&&d.data.splice(l,1)}g.updateSignup(d)})};a.formatDate=function(a,b){var c=a.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});a=$.datepicker.formatDate("dd/mm/yy",a);return a+" @"+c+" - "+b};a.formatPhone=function(a){return(a||"").replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3")};a.getRemaining=
function(c){for(var b=a.signups.find(function(a){return a.date.getTime()===c.getTime()}),d=a.total,e=0;e<b.data.length;e++)d-=b.data[e].count||0;return d};a.checkSignup=function(){var c=a.formData;if(c){for(var b=null,d=null,e=null,h,k,f=a.signups.length-1;0<=f;f--)if(h=a.signups[f],a.formData[h.date]=a.formData[h.date]||{},null===b&&null===d&&null===e)for(var g=0;g<h.data.length;g++)k=h.data[g],b=m.neutralize(k.name,!0),d=c.name&&m.neutralize(c.name,!0)||null,b=c.name&&b.match(new RegExp(d+"$","i")),
d=c.email&&k.email===c.email||null,e=c.phone&&k.phone===c.phone||null,b||d||e?(d||e||(c.name=k.name),void 0===c.name&&(c.name=k.name),void 0===c.email&&(c.email=k.email),void 0===c.phone&&(c.phone=k.phone)):void 0===c.name&&(""===c.email&&(c.email=void 0),""===c.phone&&(c.phone=void 0));for(f=a.signups.length-1;0<=f;f--)if(h=a.signups[f],h.allow){if(null===b&&null===d&&null===e)for(k=a.signups.length-1;0<=k;k--)a.formData[h.date].count=null;for(g=0;g<h.data.length;g++){k=h.data[g];var n=k.email&&
k.email===c.email,p=k.phone&&k.phone===c.phone;if(k.name&&k.name===c.name||n||p)a.formData[h.date].name=c.name,a.formData[h.date].email=c.email,a.formData[h.date].phone=c.phone,a.formData[h.date].count=k.count}}$(".content .name").trigger("oninput");$(".content .email").trigger("oninput");$(".content .count").trigger("oninput")}};a.checkLimit=function(){a.disableSave="";for(var c={},b=a.signups.length-1;0<=b;c={$jscomp$loop$prop$data$12:c.$jscomp$loop$prop$data$12},b--){var d=a.signups[b];if(d.allow){var e=
d.date;c.$jscomp$loop$prop$data$12=a.formData[e];e=a.getRemaining(e);var f=void 0;c.$jscomp$loop$prop$data$12&&(f=d.data.find(function(a){return function(b){return a.$jscomp$loop$prop$data$12.name&&b.name===a.$jscomp$loop$prop$data$12.name||a.$jscomp$loop$prop$data$12.email&&b.email===a.$jscomp$loop$prop$data$12.email||a.$jscomp$loop$prop$data$12.phone&&b.phone===a.$jscomp$loop$prop$data$12.phone}}(c)),c.$jscomp$loop$prop$data$12.error=null,c.$jscomp$loop$prop$data$12.count>e+(f&&f.count||0)&&(c.$jscomp$loop$prop$data$12.error=
"Kh\u00f4ng c\u00f2n \u0111\u1ee7 ch\u1ed7 cho "+c.$jscomp$loop$prop$data$12.count+" ng\u01b0\u1eddi",a.disableSave="disabled"))}}};a.prevList=function(){$("html").scrollTop(0,0);--a.listIndex;p()};a.nextList=function(){$("html").scrollTop(0,0);a.listIndex+=1;p()};var f=function(){a.signups&&0!==a.signups.length||r();e.addEventListener("hashchange",function(b){a.signups?(/\/signup$/.test(b.newURL)&&a.$apply(function(){a.formData={}}),/\/summary$/.test(b.newURL)&&!a.signupData&&(location.hash="/signup")):
r()})},r=function(){n().then(function(){var b=a.signups.reduce(function(a,b){b.allow&&a.push(b);return a},[]);a.allows=0<b.length;p();/\/(signup|list)$/.test(location.hash)||(location.hash="/signup")})},n=function(){var c=b.defer();g.loadSignups().then(function(b){a.signups=b;a.signuplist=b.reduce(function(a,b){b.list&&a.push(b);return a},[]);c.resolve()});return c.promise},p=function(){a.nav.prev=0===a.listIndex?"disabled":"";a.nav.next=a.listIndex===a.signuplist.length-1?"disabled":""}};b.$inject=
["$scope","$q","$window","ParishService","AppUtil"];app.controller("thanhle",b)})();(function(){var b=function(a,b){var e=location.pathname.split("/")[1];a.when("/summary",{templateUrl:"/"+e+"/thanhle/summary.html"}).when("/list",{templateUrl:"/"+e+"/thanhle/list.html"}).when("/fulllist",{templateUrl:"/"+e+"/thanhle/fulllist.html"}).otherwise({templateUrl:"/"+e+"/thanhle/signup.html"});b.hashPrefix("")};b.$inject=["$routeProvider","$locationProvider"];app.config(b)})();
