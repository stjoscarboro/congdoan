var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
var $jscomp$destructuring$var0=require("./angular-app.js"),app=$jscomp$destructuring$var0.app,$jscomp$destructuring$var1=require("./app-secret.js"),airtable=$jscomp$destructuring$var1.airtable;require("./airtable-service.js");
(function(){var a=function(a,c,d){var b={},g={url:atob(airtable.url.liturgy),token:atob(airtable.token),tables:{years:{fields:["id","name","date"]},liturgies:{fields:["id","name","date_a","date_b","date_c"]},intentions:{fields:["id","name","date_a","date_b","date_c"]},cached:{fields:["date","data1","data2"]}}};c.defaults.headers.common.Authorization="Bearer "+g.token;b.loadYears=function(){var b=a.defer();d.getData("years",g).then(function(a){b.resolve(a)});return b.promise};b.loadLiturgies=function(b){var c=
a.defer();b=!1===b?b:!0;l().then(function(a){b&&a&&0<a.records.length?c.resolve(a.records):m().then(function(b){var f=JSON.stringify(b);f={fields:{date:new Date,data1:f.substring(0,1E5),data2:f.substring(1E5)}};d.updateData("cached",g,a.refId,f);c.resolve(b)})});return c.promise};b.findLiturgy=function(a,b){return b.find(function(b){return b.date.toLocaleDateString()===a.toLocaleDateString()})};var m=function(){var b=a.defer(),c={a:"1",b:"2",c:"3"},e=function(a,b){var d;a.find(function(a){for(var f=
$jscomp.makeIterator(Object.keys(c)),e=f.next();!e.done;e=f.next())a["date_"+e.value].getTime()===b.getTime()&&(d=a)});return d?d.name:null};a.all([d.getData("liturgies",g),d.getData("intentions",g)]).then(function(a){var d=a[1];a=a[0].reduce(function(a,b){for(var f={},g=$jscomp.makeIterator(Object.keys(c)),h=g.next();!h.done;f={$jscomp$loop$prop$date$3:f.$jscomp$loop$prop$date$3},h=g.next()){h=h.value;f.$jscomp$loop$prop$date$3=b["date_"+h];var k=f.$jscomp$loop$prop$date$3&&a.find(function(a){return function(b){return b.date.getTime()===
a.$jscomp$loop$prop$date$3.getTime()}}(f));k?k.intention=b.name:f.$jscomp$loop$prop$date$3&&(k={id:b.id,name:b.name,year:c[h],date:f.$jscomp$loop$prop$date$3,intention:e(d,f.$jscomp$loop$prop$date$3)},a.push(k))}return a},[]);b.resolve(a)});return b.promise},l=function(){var b=a.defer(),c=new Date,e={records:[]};d.getData("cached",g).then(function(a){a&&0<a.length&&(a=a[0],e.refId=a.refId,(e.date=a.date)&&432E5>c.getTime()-a.date.getTime()&&(e.records=JSON.parse(a.data1+a.data2),e.records.forEach(function(a){a.date=
d.parseDate(a.date)})));b.resolve(e)});return b.promise};return b};a.$inject=["$q","$http","AirtableService"];app.factory("LiturgyService",a)})();
