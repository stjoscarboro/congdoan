var $jscomp$destructuring$var0=require("./angular-app.js"),app=$jscomp$destructuring$var0.app,$jscomp$destructuring$var1=require("./app-secret.js"),airtable=$jscomp$destructuring$var1.airtable;require("./airtable-service.js");require("./liturgy-service.js");
(function(){var b=function(b,c,d,f,g){c={};var e={url:atob(airtable.url.parish),key:atob(airtable.key),tables:{mass:{fields:["date","active","data","liturgy"]}}};c.loadSignups=function(){var a=b.defer(),h=new Date;b.all([f.loadLiturgies(),d.getData("mass",e)]).then(function(b){b=b[1];b.sort(function(a,b){a=a.date;b=b.date;return a.getTime()<b.getTime()?-1:a.getTime()>b.getTime()?1:0});var c=[];b.forEach(function(a){a.active&&a.date.getTime()>h.getTime()&&(a.data=a.data?JSON.parse(a.data):[],c.push(a))});
a.resolve(c)});return a.promise};c.updateSignup=function(a){var b=k(a);return d.updateData("mass",e,a.refId,b)};var k=function(a){a.data=a.data.map(function(a){return g.pick(a,"name","email","phone","count","order")});return{fields:{date:a.date,active:!!a.active,data:JSON.stringify(a.data)}}};return c};b.$inject=["$q","$http","AirtableService","LiturgyService","AppUtil"];app.factory("ParishService",b)})();
