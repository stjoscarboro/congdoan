var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,e,b){a instanceof String&&(a=String(a));for(var c=a.length,d=0;d<c;d++){var g=a[d];if(e.call(b,g,d,a))return{i:d,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,b){a!=Array.prototype&&a!=Object.prototype&&(a[e]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,e,b,c){if(e){b=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var d=a[c];d in b||(b[d]={});b=b[d]}a=a[a.length-1];c=b[a];e=e(c);e!=c&&null!=e&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var e=0;return function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}}};
$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,e){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:e})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(b){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(b||"")+"_"+e++,b)}var e=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,e){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,c={next:function(){if(b<a.length){var d=b++;return{value:e(d,a[d]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.owns=function(a,e){return Object.prototype.hasOwnProperty.call(a,e)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,e){for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var d in c)$jscomp.owns(c,d)&&(a[d]=c[d])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
var $jscomp$destructuring$var0=require("./angular-app.js"),app=$jscomp$destructuring$var0.app,$jscomp$destructuring$var1=require("./airtable-secret.js"),__url=$jscomp$destructuring$var1.__url,__key=$jscomp$destructuring$var1.__key;require("./airtable-service.js");require("./liturgy-service.js");
(function(){var a=function(a,b,c,d,g){b={};var e={url:__url.parish,key:__key,tables:{mass:{fields:["date","active"]},signup:{fields:"all"}}};b.loadSignups=function(){var b=a.defer();a.all([d.loadLiturgies(),c.getData("mass",e),c.getData("signup",e)]).then(function(a){var e=a[0],c=a[1].reduce(function(a,b){b.active&&a.push(b);return a},[]),d=a[2],f=[],k=new Date;c.forEach(function(a){a=a.date;if(a>k){var b={date:a,items:[]};f.push(b);var c=e.find(function(b){return b.date.getTime()===a.getTime()});
c&&(b.liturgy=c.name);d.forEach(function(a){l(b,a)})}});f.sort(function(a,b){return a.date<b.date?-1:1});b.resolve(f)});return b.promise};b.createSignup=function(b){var d=a.defer();h(null,b).then(function(a){c.createData("signup",e,a).then(function(a){b.refId=a.id;d.resolve()})});return d.promise};b.updateSignup=function(b,d){var f=a.defer();h(b,d).then(function(a){c.updateData("signup",e,b.refId,a).then(function(a){f.resolve(a)})});return f.promise};var l=function(a,b){var c={refId:b.refId},e=!1;
Object.keys(b.fields).forEach(function(d){switch(!0){case "email"===d:c[d]=b.fields[d];break;case d===a.date.toISOString().slice(0,10):d=b.fields[d]||"{}",Object.assign(c,{date:a.date}),Object.assign(c,g.pick(JSON.parse(d),"count","confirm")),e=!0}});e&&a.items.push(c)},h=function(b,d){var f=a.defer();if(b)c.getData("signup",e,b.refId).then(function(a){var b=d.date.toISOString().slice(0,10);a=a[0].fields;var c={};Object.assign(a,(c[b]=JSON.stringify({count:d.count}),c));f.resolve({fields:a})});else{b=
d.date.toISOString().slice(0,10);var g={};b=(g.email=d.email,g[b]=JSON.stringify({count:d.count}),g);f.resolve({fields:b})}return f.promise};return b};a.$inject=["$q","$http","AirtableService","LiturgyService","AppUtil"];app.factory("ParishService",a)})();
