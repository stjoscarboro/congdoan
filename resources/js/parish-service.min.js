var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,d,b){a instanceof String&&(a=String(a));for(var c=a.length,e=0;e<c;e++){var g=a[e];if(d.call(b,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,b){a!=Array.prototype&&a!=Object.prototype&&(a[d]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,d,b,c){if(d){b=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var e=a[c];e in b||(b[e]={});b=b[e]}a=a[a.length-1];c=b[a];d=d(c);d!=c&&null!=d&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var d=0;return function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}}};
$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,d){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:d})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(b){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(b||"")+"_"+d++,b)}var d=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,c={next:function(){if(b<a.length){var e=b++;return{value:d(e,a[e]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.owns=function(a,d){return Object.prototype.hasOwnProperty.call(a,d)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,d){for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var e in c)$jscomp.owns(c,e)&&(a[e]=c[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
var $jscomp$destructuring$var0=require("./angular-app.js"),app=$jscomp$destructuring$var0.app,$jscomp$destructuring$var1=require("./airtable-secret.js"),__url=$jscomp$destructuring$var1.__url,__key=$jscomp$destructuring$var1.__key;require("./airtable-service.js");require("./liturgy-service.js");
(function(){var a=function(a,b,c,e,g){b={};var d={url:__url.parish,key:__key,tables:{mass:{fields:["date","active"]},signup:{fields:"all"}}};b.loadSignups=function(){var b=a.defer();a.all([e.loadLiturgies(),c.getData("mass",d),c.getData("signup",d)]).then(function(a){var d=a[0],c=a[1].reduce(function(a,b){b.active&&a.push(b);return a},[]),e=a[2],f=[],k=new Date;c.forEach(function(a){a=a.date;if(a>k){var b={date:a,items:[]};f.push(b);var c=d.find(function(b){return b.date.getTime()===a.getTime()});
c&&(b.liturgy=c.name);e.forEach(function(c){var d={refId:c.refId},e=!1;Object.keys(c.fields).forEach(function(b){switch(!0){case b===a.toISOString().slice(0,10):b=c.fields[b]||"{}";Object.assign(d,{date:a});Object.assign(d,g.pick(JSON.parse(b),"count","confirm"));e=!0;break;default:d[b]=c.fields[b]}});e&&b.items.push(d)})}});f.sort(function(a,b){return a.date<b.date?-1:1});b.resolve(f)});return b.promise};b.createSignup=function(b){var e=a.defer(),f=h(b);c.createData("signup",d,f).then(function(a){b.refId=
a.id;e.resolve()});return e.promise};b.updateSignup=function(b,e){var f=a.defer();e=h(e);c.updateData("signup",d,b,e).then(function(a){f.resolve(a)});return f.promise};var h=function(a){var b=a.date.toISOString().slice(0,10),c={};return{fields:(c.email=a.email,c[b]=JSON.stringify({count:a.count}),c)}};return b};a.$inject=["$q","$http","AirtableService","LiturgyService","AppUtil"];app.factory("ParishService",a)})();
